<%= stylesheet_link_tag "inbox", "data-turbo-track": "reload" %>

<% chats.each do |chat| %>
  <a href= "<%= user_chat_path(user, chat) %>" class="p-3 list-group-item list-group-item-action border-bottom link-light">
    <% unless chat.messages.nil? || chat.messages.empty? %>
      <div class="d-flex gap-2 justify-content-sm-center justify-content-lg-start">
        
        <% if user == chat.user && chat.user2.avatar.present? %>
          <%= image_tag(User.find(chat.user2.id).avatar, class: "rounded-circle ", size: "45x45")%>
        <% elsif user == chat.user2 && chat.user.avatar.present? %>
         <%= image_tag(chat.user.avatar, class: "rounded-circle ", size: "45x45") %>
        <% else %>
          <span class="material-icons-outlined" style="font-size: 45px;">account_circle</span>
        <% end %>

        <div class="d-block">
          <span class="d-block d-sm-none d-lg-block align-self-start">@<%= user == chat.user ? chat.user2.username : chat.user.username %></span>

          <% if chat.messages.last.user == user || message_notifications(user, chat).last.read?  %>
            <span class="d-flex d-sm-none d-lg-flex gap-2 text-truncate text-muted"><span class="d-inline-block text-truncate"><%= "#{chat.messages.last.content} "%></span><span>· <%= "#{time_until_next_unit(chat.messages.last)}" %></span></span>
          <% elsif message_notifications(user, chat).last.unread? %>
            <span class="d-flex d-sm-none d-lg-flex gap-2 text-truncate"><%= "#{chat.messages.last.content} " %> <span class="text-muted"> · <%= "#{time_until_next_unit(chat.messages.last)}" %></span></span>
          <% end %>
        </div>
      </div>
    <% end %>
  </a>
<% end %>